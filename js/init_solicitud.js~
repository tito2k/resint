$(document).ready(function() {
/* /////////////////////////////////////////
// GRILLA
//////////////////////////////////////////*/
	var lastsel;
   jQuery("#list").jqGrid({
		datatype: "local",
		colNames:['#','Nombre','Cantidad'],
		colModel:[
			{name:'id',index:'id', width:6,editable:false},
			{name:'name',index:'name', width:40,editable:true,editoptions:{size:10,maxlength:10}} ,
			{name:'cant',index:'cant', width:40,editable:true,editoptions:{size:10,maxlength:10},editrules:{number:true}} 
		],
		rowNum: 40,
		rowList: [40,80],
		height: 200,
		width: 300,
		sortname: '_key_N_idarticulo',
		viewrecords: true,
		sortorder: "asc",
 		shrinkToFit: true,
		editurl:"#",
		cellsubmit:'clientArray',
		onSelectRow: function(id){
			if(id && id!==lastsel){
				jQuery('#list').jqGrid('restoreRow',lastsel);
				jQuery('#list').jqGrid('editRow',id,true,autocompletar);
				lastsel=id;
			}
		}
   });

	jQuery("#list").jqGrid('navGrid','#pager', 
		{height:400,width:600,reloadAfterSubmit:false}, //options 
		{reloadAfterSubmit:true,closeAfterEdit:true,afterSubmit:callBack}, // edit options 
		{reloadAfterSubmit:true,closeAfterAdd:true,editData:{_key_N_idarticulo:"_new"}}, // add options 
		{reloadAfterSubmit:false}, // del options 
		{} // search options 
	);

	var mydata3 = [
		{id:"12345",name:"Desktop Computer"},
		{id:"23456",name:"Laptop"},
		{id:"34567",name:"LCD Monitor"},
		{id:"45678",name:"Speakers"},
		{id:"56789",name:"Laser Printer"},
		{id:"67890",name:"Play Station"},
		{id:"76543",name:"Mobile Telephone"},
		{id:"87654",name:"Server"},
		{id:"98765",name:"Matrix Printer"}
		];
/*
for(var i=0;i < mydata3.length;i++)
	jQuery("#list").jqGrid('addRowData',mydata3[i].id,mydata3[i]);
*/

	for(var i=0;i < 40;i++)
		jQuery("#list").jqGrid('addRowData',i,{});
	
	function autocompletar(id){
		jQuery("#"+id+"_name","#list").autocomplete({
          source: ["c++","java","php","coldfusion","javascript","asp","ruby"],


		width: 20,
		max: 4,
		highlight: false,
		multiple: false,
		multipleSeparator: " ",
		scroll: true,
		scrollHeight: 300,
		select: function(event, ui) {
          /*alert(ui.item.value);*/
            jQuery("#list").setRowData( id, { name:ui.item.value })
          }
	});
	}

	function callBack(response,postData) {

		var success = true;
		var message = "";

		return [success,message];
	}

/* /////////////////////////////////////////
// FIN GRILLA
//////////////////////////////////////////*/

	$('#idSesion').clone().appendTo('#frmSolicitud');

  var options = {
      target:       '#mensaje',
      beforeSubmit: validaForm,
      success:      formSuccess
  };      
  $('#frmSolicitud').ajaxForm(options);

	var opcDate = {
			showOn: "button"};

	$('#fecha').datepicker(opcDate);
  $('#fecha').focus();

	$('#seccion').autocomplete({source:"../../lib/query.php?tabla=secciones?desc="+$('#seccion').val()});
//	$('#aceptarSolicitud').click(pruebaBoton);

});

function validaForm()
{
	var array = jQuery("#list").jqGrid('getRowData');
alert(jQuery.param(array));
	$('#frmSolicitud').append('<input type="hidden" id="datos" name="datos" value='+jQuery.param(array)+'/>');	

	return true;
};

function formSuccess(responseText, statusText, xhr, $form)
{
	var retorno = $.parseJSON(responseText);
	mensajeInfo(retorno.mensaje);
	$('#center').empty();
};

function pruebaBoton()
{
	var datos = jQuery("#list").jqGrid('getRowData').serializeArray();
	$('#frmSolicitud').append('<input type="hidden" id="datos" name="datos" value='+datos+'/>');	

};
